---
title: "Relatório 3 - Estatística"
subtitle: "Fazendo algumas análises em R"
date: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sumário"
output: 
  html_document:
    toc: true # table of content true
    toc_depth: 2  # upto three depths of headings (specified by #, ## and ###)
    number_sections: true  ## if you want number sections at each table headerK
    theme: cosmo  # many options for theme, this one is my favorite.
    highlight: zenburn  # specifies the syntax highlighting style
    #css: my.css   # you can add your custom css, should be in same folder
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
---

```{r setup opts_chunk, include=FALSE}
# chunk options:
knitr::opts_chunk$set(echo = T, include = T, eval=T,
                      warning = F, error = T,
                      message = F, out.width = "75%",
                      fig.align = 'center',
                      results = "markup")
```

------------------------------------------------------------------------

# Dados

Lendo o conjunto de dados utilizado durante a atividade 

```{r}
df <- read.csv("~/Downloads/dados_atividade1.xlsx - Planilha1.csv")
head(df)
```

Visualização do conjunto de dados a ser utilizado. Consiste em um coluna de producao, uma de praga e uma de fertilizante. A ideia e realizar análises com base nos fertilizantes, que serão os diferentes tratamentos. 

```{r, results="asis"}
library("daewr")#use install.packages("daewr") se necessario
library("kableExtra")# para usar a funcao kable
kable(df, align='c')
```

# Descritivas

Realizando algumas análises descritivas dos dados

- Para a variavel de produção:

```{r}
library(tidyverse)
df |> group_by(Fertilizante) |> 
  summarise(media=mean(Producao), desv.pad=sd(Praga))|>
  kable(align='c', digits=2)
```

* Aparentemente existe alguma diferença entre os tratamentos. Ao se observar o gráfico abaixo fica ainda mais claro, a média entre os experimentos estão bem diferentes. O teste ANOVA irá dizer se existe alguma diferença significativa posteriormente. 

```{r}
df |> ggplot(aes(x=Fertilizante, y=Producao, color=Fertilizante)) + 
  geom_boxplot(outlier.shape=NA) +
  geom_jitter(width=0.2)
```

*fazer também para os dados binarios*

# ANOVA

Como queremos verificar se existe alguma diferença entre os tratamentos, o que desejamos testar é: 
$$H_0: \mu_{A} = \mu_{B} = \mu_{C} = \mu_{D}$$
Ou seja, a hipótese nula dos dados é que todas as médias para os diferentes fertilizantes são iguais. Aplicando a anova: 

```{r}
m <- aov(Producao ~ Fertilizante, data = df)
summary(m) 
```

# Pressupostos

Primeiro, podemos ver como os resíduos se comportam.

O modelo que estamos considerando é: $$y_{ij} = \mu_i + \epsilon_{ij}$$
Desse modo, o resíduo é definido por
$$e_{ij} = y_{ij} - \bar{y}_{i\cdot}$$

```{r}
residuo <- m$residuals
dado <- data.frame(id=1:12, residuo=residuo)
kable(dado)
```

## Resíduo versus tratamento

```{r}
plot(m, which=2, pch=19) 
```

Desejamos que os resíduos sejam bem comportandos, simétricos em torno de
uma média (normal) e que tenha mesma variância dentre os três
tratamentos.

Logo, é esperado que não haja nenhum padrão a não ser um comportamento
aleatório.

## Resíduo versus valor ajustado

Como o modelo é
$$y_{ij}=\mu_i+\epsilon_{ij},\;\;\;\;\; \epsilon_{ij}\sim N(0, \sigma^2)$$
então o valor ajustado é $$\hat{y}_{ij}=\bar{y}_{i\cdot}$$

```{r, results='asis'}
library(tidyverse)
df |> group_by(Fertilizante) |> 
  summarise(media = mean(Producao), desv.pad = sd(Producao)) |>
  kable(align='c', digits=2)
```

```{r}
plot(m, which=1, pch=19)
```

## Normalidade dos resíduos

Um pressuposto importante para a utilização da anova é a normalidade dos resíduos. Para isso é possível utilizar um gráfico qqplot. Se os dados seguirem a relação linear, muito provavelmente eles são normais. Analisando o gráfiico abaixo existem alguns valores que fogem um pouco da relação linear, porém fica dificil analisar.

```{r}
plot(m, which=2, pch = 19)
```

É possível utilizar também um envelope, que demonstra a "faixa de normalidade". Como é possível observar, existem dados que fogem do envelope. Por isso um teste de normalidade nos resíduos deve ser aplicado. 

```{r}
library("car") # se necessário: install.packages("car")
qqPlot(m$residuals, pch=19, col.lines="darkred", id=F)
```

## Testando a normalidade dos resíduos

Para testar a normalidade é possível aplicar o teste de Shapiro-Wilks. As hipóteses do teste são: 

$$H_{0} = \text{Testes seguem uma distribuição normal}\\
  H_{1} = \text{Testes não seguem uma distribuição normal}$$

Aplicando o teste: 

```{r}
shapiro.test(m$residuals)
```

Com um nível de relevância p = 0.05, é possível observar que não temos evidências suficientes para rejeitar a hipótese nula, dessa forma podemos assumir que os dados são normais. O pressuposto para a normalidade dos resíduos é válido. 

## Resíduo versus ordem de coleta dos dados

É útil também verificar se há um padrão bem definido para verificar se o
resíduo é aleatório através do gráfico de dispersão resíduo *versus*
ordem de coleta.

```{r}
plot(residuals(m) ~ ID, main="Resíduo versus ordem de coleta", font.main=1,data=df)
abline(h = 0, lty = 2)
```


# Testes para homogeneidade na variância

### F

É possível utilizar um teste F para comparar duas variâncias. As hipóteses para o teste F são: 

$$ H_{0} = \text{As variâncias são iguais}\\ H_{1} = \text{As variâncias são diferentes}$$

#### Par a par {.unnumbered}

**A e B**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="A" | df$Fertilizante=="B",])
```

**A e C**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="A" | df$Fertilizante=="C",])
```

**A e D**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="A" | df$Fertilizante=="D",])
```

**B e C**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="C" | df$Fertilizante=="B",])
```

**B e D**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="D" | df$Fertilizante=="B",])
```

**C e D**

```{r}
var.test(Producao ~ Fertilizante, data=df[df$Fertilizante=="C" | df$Fertilizante=="D",])
```

Observando todos os testes par a par acima, é possível observar que aparentemente existe homogeniedade entre as variâncias. isso satisfaz um pressuposto importante da anova. 

### Bartlett {.unnumbered}

```{r}
bartlett.test(Producao ~ Fertilizante, data=df)
```

O teste de barlett ainda confirma isso. 

<!-- ------------------------------------------------------------- -->

------------------------------------------------------------------------